var App=function(){_.extend(this,{data:{},_views:{},_viewZ:10,_currentView:null,_previousView:null,_inTransition:!1,_preloaded:{},_transitions:{},_local:!1,_device:!1})};_.extend(App.prototype,Backbone.Events,{touchSupport:"ontouchstart"in document.documentElement,touchEventEquivalents:{touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove",tap:"click"},init:function(){this.initDevice(),this.initResize(),this.trigger("init")},_transitionTimeout:null,inTransition:function(){if(this._inTransition)return!0;this._inTransition=!0;var a=this;return this._transitionTimeout=setTimeout(function(){a.doneTransition()},1250),!1},doneTransition:function(){clearTimeout(this._transitionTimeout),this._inTransition=!1},initResize:function(){var a=function(){app.viewportSize={width:$(window).width(),height:$(window).height()},app._device.system&&"ios"!=app._device.system||($(".statusbar").css("height",21),"ios"==app._device.system&&$(".statusbar").addClass("native")),app._device.system||(app.viewportSize={width:$("#viewport").width(),height:$("#viewport").height()}),app._currentView&&app._currentView.trigger("layout")};a(),$(window).on("resize",a)},currentViewZ:function(){return 100*app._viewZ},lastViewZ:function(){return app._viewZ--,100*app._viewZ},nextViewZ:function(){return app._viewZ++,100*app._viewZ},view:function(a){var b=this._views[a];return b?b:void app.showNotification("Alert","Invalid view ("+a+") requested.")},currentView:function(a,b){if(a){var c=b?this.currentView():!1;this._previousView=c,this._currentView=a,c&&c.hide(),this.doneTransition()}return this._currentView},showNotification:function(a,b,c,d){if(d=d||function(){},navigator.notification&&navigator.notification.alert)navigator.notification.alert(b,d,a||"Alert",c||"OK");else if(alert(b),d)return d()},showConfirm:function(a,b,c,d){return d=d||function(){},navigator.notification&&navigator.notification.confirm?void navigator.notification.confirm(b,d,a||"Confirm",c||["OK","Cancel"]):d(confirm(b)?2:1)},showLoadingSpinner:function(a,b){var c=this;return console.log("[showLoadingSpinner] - Showing loading spinner."),this._hidingSpinner?($("#app-loading").velocity("stop"),this._hidingSpinner=!1,void $("#app-loading").velocity({opacity:1},{duration:300,easing:"easeInOutSine"})):void(this._showingSpinner||this._spinnerVisible||(this._showingSpinner=!0,this._spinnerVisible=!0,$("#app-loading").css({"z-index":this.currentViewZ()+99,opacity:0,display:"block"}).velocity({opacity:1},{duration:300,easing:"easeInOutSine",complete:function(){c._showingSpinner=!1,b&&b()}}),a?$("#app-loading").addClass("with-label").find(".label").text(a):$("#app-loading").removeClass("with-label"),$("#app-loading .spinner").spinner("start")))},hideLoadingSpinner:function(a){var b=this;console.log("[hideLoadingSpinner] - Hiding loading spinner."),this._hidingSpinner||this._spinnerVisible&&(this._hidingSpinner=!0,$("#app-loading").velocity({opacity:0},{duration:300,easing:"easeInOutSine",complete:function(){b._hidingSpinner&&(b._hidingSpinner=!1,b._spinnerVisible=!1,$("#app-loading").hide(),$("#app-loading .spinner").spinner("stop"),a&&a())}}))},changeStatusBarStyle:function(a,b){a&&setTimeout(function(){if("ios"==app._device.system)switch(a){case"black":StatusBar.styleDefault();break;case"white":StatusBar.styleLightContent()}if(!app._device.system)switch(a){case"black":$(".statusbar").removeClass("white").addClass("black");break;case"white":$(".statusbar").removeClass("black").addClass("white")}},b||0)},scrollContainer:function(a){if(!a.disableAutoScroll){var b=a.$el.find(".container");_.each(b,function(a){a.scrollTop=0})}},hideKeyboard:function(){document.activeElement.tagName.toLowerCase().match(/input|textarea|select/)&&document.activeElement.blur()},disableFields:function(){if("ios"==app._device.system){var a=app.currentView().$el.find("input,textarea,select");a.prop("disabled",!0),setTimeout(function(){a.prop("disabled",!1)},1e3)}},getAPIEndpoint:function(a){return config.baseURL+"/api/app/"+a+"?version="+app.data.version},initDevice:function(){var a=navigator.userAgent.toLowerCase();app._device={mobile:/iphone|ipad|ipod|android/i.test(a),system:!1,tablet:!1,browser:!1,model:!1,size:!1},a.match(/iphone|ipad|ipod/)&&(app._device.system="ios",a.match("iphone")?app._device.model="iphone":a.match("ipad")?app._device.model="ipad":a.match("ipad")&&(app._device.model="ipad",app._device.tablet=!0),("iphone"==app._device.model||"ipod"==app._device.model)&&(app._device.size=$(window).height()<=480?"short":"tall")),a.match("android")&&(app._device.system="android",a.match("mobile")||(app._device.tablet=!0)),"android"==app._device.system&&(WebFontConfig={google:{families:["Roboto"]}},function(){var a=document.createElement("script");a.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js",a.type="text/javascript",a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}()),app._device.system||$("#viewport").addClass("device-desktop")}}),app=new App;