var View;!function(){var a=/^(\S+)\s*(.*)$/;if(!app.touchSupport){var b=Backbone.View.prototype.delegateEvents;Backbone.View.prototype.delegateEvents=function(c){if(!c&&!(c=_.result(this,"events")))return this;var d={};for(var e in c){var f=e.match(a),g=f[1],h=f[2];g in app.touchEventEquivalents&&(g=app.touchEventEquivalents[g]),d[g+(h?" "+h:"")]=c[e]}b.call(this,d)}}View=function(a,b){this.id=a,this.uniqueId=_.uniqueId("view"),this.$el=$("#view-"+a),this.el=this.$el[0],this._configure(b),this.initialize.apply(this,arguments),app._views[a]=this},_.extend(View.prototype,Backbone.Events,{$:function(a){return this.$el.find(a)},field:function(a){return this.$("#view-"+this.id+"-field-"+a)},initialize:function(){},_configure:function(a){a=a||{},_.extend(this,_.omit(a,["events","on"])),this.on(a.on||{});var b=!1;this.prepare=function(){b||(b=!0,a.events&&this.delegateEvents(a.events),a.buttons&&this.initButtons(a.buttons),this.initTabs(),this.initLists(),this.initSwitchers(),this.trigger("init"))}},delegateEvents:function(b){return _.each(b,function(b,c){if(_.isFunction(b)||(b=this[b]),b){var d=c.match(a),e=d[1].replace(/\|/g," "),f=d[2];!app.touchSupport&&e in app.touchEventEquivalents&&(e=app.touchEventEquivalents[e]),b=_.bind(b,this);var g=function(a){return app._inTransition?!0:void b(a,this)};""===f?this.$el.on(e,g):this.$el.on(e,f,g)}},this),this},initButtons:function(a){return _.each(a,function(a,b){if(this.$(b).button(),_.isFunction(a)||(a=this[a]),a){a=_.bind(a,this);var c=function(b){return app._inTransition?!0:void a(b,this)};this.$el.on("press",b,c)}},this),this},initTabs:function(){var a=this,b=this.$(".tabs .tab");b.size()&&(b.each(function(){$(this).button().on("press",function(){var b=$(this).data("tab");a.$(".tab").each(function(){var a=$(this);a[a.data("tab")==b?"addClass":"removeClass"]("selected")}),a.$(".tab-content").each(function(){var a=$(this);if(a.data("tab")==b){a.show();var c=a.parent();c.size()&&(c[0].scrollTop=0)}else a.hide()})})}).first().trigger("press"),this.$(".titlebar .title").on("swipeLeft",function(){a.$(".tab.selected").next().trigger("press")}).on("swipeRight",function(){a.$(".tab.selected").prev().trigger("press")}))},initLists:function(){var a=this,b=this.$(".list .item");b.size()&&b.each(function(){$(this).button().on("press",function(){var b=$(this).data("item");a.$(".item").each(function(){var a=$(this);a[a.data("item")==b?"addClass":"removeClass"]("selected")})})})},initSwitchers:function(){var a=this.$(".switcher");a.size()&&a.each(function(){var a=$(this);if($input=a.find("input"),$input.length){var b=$('<div class="state">On</div>').appendTo(a);$('<div class="handle"></div>').appendTo(a);var c=function(){var c=a.hasClass("on");b.text(c?"Off":"On"),b.css("opacity",0),b.animate({opacity:1}),a.removeClass("on off"),a.addClass(c?"off":"on"),$input.val(c?"no":"yes")};a.on("click",function(){return c()}),a.on("swipeRight",function(){return on?void 0:c()}),a.on("swipeLeft",function(){return on?c():void 0})}})},isVisible:function(){return app.currentView()==this},show:function(a,b){if(!app.inTransition()&&!this.isVisible()){var c=this;if(this.prepare(),this.setZ(app.nextViewZ()),this.$el.show(),this.trigger("visible"),this.trigger("layout"),a){var d=0,e=0;switch(a){case"slide-up":e=app.viewportSize.height;break;case"slide-down":e=-app.viewportSize.height;break;case"slide-left":d=-app.viewportSize.width;break;case"slide-right":d=app.viewportSize.width}this.$el.css({transform:"translateX("+d+"px) translateY("+e+"px)","-webkit-transform":"translateX("+d+"px) translateY("+e+"px)",opacity:1}),setTimeout(function(){c.$el.velocity({translateX:[0,d],translateY:[0,e]},{duration:b?300:500,easing:b?"easeInOutSine":"easeOutExpo",complete:function(){app.currentView(c,!0)}})},10)}else this.$el.show(),this.$el.css("opacity",1),app.currentView(this,!0)}},reveal:function(a,b){if(!app.inTransition()&&!this.isVisible()){var c=this,d=app.currentView();if(!d)return this.show();if(this.prepare(),d.setZ(app.nextViewZ()),this.setZ(app.lastViewZ()),this.$el.show(),this.trigger("visible"),this.trigger("layout"),a){var e=0,f=0;switch(a){case"slide-up":f=-app.viewportSize.height;break;case"slide-down":f=app.viewportSize.height;break;case"slide-left":e=-app.viewportSize.width;break;case"slide-right":e=app.viewportSize.width}this.$el.css({transform:"translateX(0px) translateY(0px)","-webkit-transform":"translateX(0px) translateY(0px)",opacity:1}),setTimeout(function(){d.$el.velocity({translateX:[e,0],translateY:[f,0]},{duration:b?300:400,easing:b?"easeOutSine":"easeOutSine",complete:function(){app.currentView(c,!0),d.$el.css({transform:"translateX(0px) translateY(0px)","-webkit-transform":"translateX(0px) translateY(0px)",opacity:0})}})},10)}else this.$el.css("opacity",1),this.trigger("visible"),app.currentView(this,!0)}},setZ:function(a){this.$el.css("z-index",a)},hide:function(){var a=this;app.hideKeyboard(),app.scrollContainer(a),this.$el.hide(),this.trigger("hidden")}})}();